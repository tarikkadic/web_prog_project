<!DOCTYPE html>
<html lang="zxx">
  <head>
    <!-- Required meta tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>News Now</title>
    <!-- plugin css for this page -->
    <link
      rel="stylesheet"
      href="./vendors/mdi/css/materialdesignicons.min.css"
    />
    <link rel="stylesheet" href="./vendors/aos/dist/aos.css/aos.css" />

    <!-- End plugin css for this page -->
    <link rel="shortcut icon" href="./assets/images/logo.png" />
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.11.1/css/jquery.dataTables.min.css">

    <link rel="stylesheet" href="./assets/css/jQuerySPApp.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <!-- inject:css -->
    <link rel="stylesheet" href="./assets/css/style.css">
    <!-- endinject -->
  </head>

  <body>
    <div class="container-scroller">
      <div class="main-panel">
        <!-- partial:partials/_navbar.html -->
        <header id="header">
          <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light">
              <div class="navbar-top">
                <div class="d-flex justify-content-between align-items-center">

                  <ul class="navbar-top-right-menu">
                    <button type="button" class="btn btn-primary admin-stuff stick-right" onclick="location.href='#users';">Users</button>
                      <button type="button" class="btn btn-primary nav-item admin-stuff stick-right" onclick="location.href='#reported-comments';">Moderation</button>
                    <button type="button" class="btn btn-primary nav-item admin-stuff stick-right" data-toggle="modal" data-target="#article-modal">Add new article</button>
                    <li class="nav-item guest-user">
                      <a href="login.html" class="nav-link stick-right">Login</a>
                    </li>
                    <li class="nav-item guest-user">
                      <a href="register.html" class="nav-link stick-right">Register</a>
                    </li>
                    <li class="nav-item logged-user">
                      <a href="#" onclick="doLogout();" class="nav-link stick-right">Log Out</a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="navbar-bottom">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <a class="navbar-brand" href="#home"
                      ><img style="max-width: 130px;" src="assets/images/logo.png" alt=""
                    ></a>
                  </div>
                  <div>
                    <button
                      class="navbar-toggler"
                      type="button"
                      data-target="#navbarSupportedContent"
                      aria-controls="navbarSupportedContent"
                      aria-expanded="false"
                      aria-label="Toggle navigation"
                    >
                      <span class="navbar-toggler-icon"></span>
                    </button>
                    <div
                      class="navbar-collapse justify-content-center collapse"
                      id="navbarSupportedContent"
                    >
                      <ul
                        class="navbar-nav d-lg-flex justify-content-between align-items-center"
                      >

                        <li class="nav-item active">
                          <a class="nav-link" href="#home">Home</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#covid-19">COVID-19</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#business">Business</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#sport">Sport</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#art">Art</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#politics">POLITICS</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#travel">Travel</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </nav>

            <main id="jqueryspapp" role="main">
             <section id="home" data-load="home.html"></section>
             <section id="covid-19" data-load="covid19.html"></section>
             <section id="business" data-load="business.html"></section>
             <section id="sport" data-load="sport.html"></section>
             <section id="art" data-load="art.html"></section>
             <section id="politics" data-load="politics.html"></section>
             <section id="travel" data-load="travel.html"></section>
             <section id="article" data-load="article.html"></section>
             <section id="reported-comments" data-load="reported_comments.html"></section>
             <section id="comments" data-load="comments.html"></section>
             <section id="users" data-load="users.html"></section>
           </main>

          </div>
        </header>

        <!-- partial -->
        <div class="modal fade" id="article-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Add article</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">Ã—</span>
              </button>
            </div>
            <div class="modal-body">
              <form type="form" id="add-article-modal">
                <div class="form-group">
                  <label for="article-title" class="form-control-label">Title</label>
                  <input type="text" name="title" class="form-control" id="article-title" required>
                </div>
                <div class="form-group">
                  <label for="article-image" class="form-control-label">Article image</label>
                  <input type="file" name="image" class="form-control" id="article-image" onchange="file2base64(this);">
                </div>
                <div class="form-group">
                  <label for="article-subtitle" class="form-control-label">Subtitle</label>
                  <textarea type="text" name="subtitle" class="form-control" id="article-subtitle" required></textarea>
                </div>
                <div class="form-group">
                  <label for="article-body" class="form-control-label">Article body</label>
                  <textarea class="form-control" name="article_body" id="article-body" required></textarea>
                </div>
                <label for="category">Category</label>
                <select name="category" id="categories" required>
                  <option value="">Choose a category</option>
                  <option value="covid-19">COVID-19</option>
                  <option value="business">Business</option>
                  <option value="sport">Sport</option>
                  <option value="art">Art</option>
                  <option value="politics">Politics</option>
                  <option value="travel">Travel</option>
                </select>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Add article</button>
                </div>
              </form>
            </div>

          </div>
        </div>
      </div>

        <!-- main-panel ends -->
        <!-- container-scroller ends -->

        <!-- partial:partials/_footer.html -->
        <footer>
          <div class="footer-top">
            <div class="container">
              <div class="row">
                <div class="col-sm-5">
                  <img style="max-width: 130px;" src="assets/images/logo.png" class="footer-logo" alt="" />
                  <h5 class="font-weight-normal mt-4 mb-5">
                    News Now is your news, entertainment, fashion website. We
                    provide you with the latest breaking news straight from
                    the entertainment industry.
                  </h5>
              </div>
              <div class="col-sm-3">
                <h3 class="font-weight-bold mb-3">CATEGORIES</h3>
                <div class="footer-border-bottom pb-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <a href="#covid-19"><h5 class="mb-0 font-weight-600">Covid-19</h5></a>
                  </div>
                </div>
                <div class="footer-border-bottom pb-2 pt-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <a href="#business"><h5 class="mb-0 font-weight-600">Business</h5></a>
                  </div>
                </div>
                <div class="footer-border-bottom pb-2 pt-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <a href="#sport"><h5 class="mb-0 font-weight-600">Sport</h5></a>
                  </div>
                </div>
                <div class="footer-border-bottom pb-2 pt-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <a href="#art"><h5 class="mb-0 font-weight-600">Art</h5></a>
                  </div>
                </div>
                <div class="footer-border-bottom pb-2 pt-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <a href="#politics"><h5 class="mb-0 font-weight-600">Politics</h5></a>
                  </div>
                </div>
                <div class="pt-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <a href="#travel"><h5 class="mb-0 font-weight-600">Travel</h5></a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </footer>

        <!-- partial -->
      </div>
    </div>
    <!-- inject:js -->
    <script src="./assets/js/jquery.min.js"></script>

    <script src="./assets/js/restClient.js"></script>
    <script src="./assets/js/jquery-3.6.0.min.js"></script>
    <script src="./vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- plugin js for this page -->
    <script src="./vendors/aos/dist/aos.js/aos.js"></script>
    <!-- End plugin js for this page -->
    <!-- Custom js for this page-->
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.11.1/js/jquery.dataTables.min.js"></script>
    <script src="./assets/js/demo.js"></script>
    <script src="./assets/js/utils.js"></script>
    <script src="./assets/js/jquery.easeScroll.js"></script>
    <!-- End custom js for this page-->
    <script src="//cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="./assets/js/jQuerySPApp.js"></script>



    <script type="text/javascript">

    function file2base64(event){
      console.log(event.files);

      var f = event.files[0];

      var reader = new FileReader();
      reader.onload = (function(theFile){
        return function(e){
          var im = {"image" : e.target.result};
          JSON.stringify(im);
          $("#add-article-modal").validate({
            submitHandler: function(form, event){
              event.preventDefault();
              var article_info = jsonize_form($(form));
              var article = Object.assign(article_info, im);
              addArticle(article);
              $('#article-modal').modal('toggle');
            }
          });
        };
      })(f);

      reader.readAsDataURL(f);
    }





    $('#article-modal').on('hidden.bs.modal', function () {
    $(this).find('form').trigger('reset');
    });

    function addArticle(article){
      $.ajax({
        url: "api/articles",
        type: "POST",
        data: article,
        beforeSend: function(xhr){xhr.setRequestHeader('Authentication', localStorage.getItem("token"));},
        success: function(data){
          toastr.success("Article has been added!");
          location.reload();
          console.log();
        },
        error: function(jqXHR, textStatus, errorThrown){
          console.log(jqXHR);
        }
      });
    }

    $(document).ready(function(){
      var app = $.jQuerySPApp({defaultView  : "home"}); // initialize
      app.run();

      if(!window.localStorage.getItem("token")){
        $('.logged-user').hide();
        $('.admin-stuff').remove();
      } else{
        $('.guest-user').hide();
        var user_info = parse_jwt(window.localStorage.getItem("token"));
        if(user_info.r != "ADMIN"){
          $('.admin-stuff').remove();
        }
      }
    });

    function doLogout(){
            window.localStorage.clear();
            window.location = "index.html";
          }

    </script>
  </body>
</html>
